version: "3.8"
services:
  timescaledb:
    image: timescale/timescaledb-ha:pg14-latest
    ports:
      - "5555:5432"
    environment:
      - POSTGRES_PASSWORD=postgres
    volumes:
      - timescaledb:/home/postgres/pgdata/data

  redis:
    image: redis:latest
    ports:
      - "6379:6379"

  backend:
    build:
      context: ./backend
      dockerfile: ../support/backend/Dockerfile
    volumes:
      - ./backend:/app
    ports:
      - "5000:8080"
      - "5345:2345"
    depends_on:
      - timescaledb
      - redis

  car-integration:
    build:
      context: ./car-integration
      dockerfile: ../support/car-integration/Dockerfile
    volumes:
      - ./car-integration:/app
    ports:
      # DECISION MODULE
      - "6060:6060"
      # BACKEND
      - "5050:5050"
      # CAR SIMULATOR
      - "4040:4040/udp"
    depends_on:
      - timescaledb

  decision-module:
    build:
      context: ./decision-module
      dockerfile: ../support/decision-module/Dockerfile
    volumes:
      - ./decision-module:/app
    links:
      - car-integration
    ports:
      - "6061:6061"
      - "5051:5051"
    depends_on:
      - timescaledb

  car-simulator:
    build:
      context: ./car-simulator
    links:
      - car-integration
    ports:
      - "70:70"
    depends_on:
      - timescaledb

volumes:
  timescaledb:
